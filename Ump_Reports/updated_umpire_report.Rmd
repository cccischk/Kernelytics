---
params:
  game_data: "7_2 GroundSloths @ BlueCaps.csv"
  home_team: "BLCP"
  away_team: "GRND"
  game_date: "07/02"
  league: "KCL"

output: 
  pdf_document:
    keep_tex: true
    includes:
      in_header: header.tex
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(patchwork)

here::i_am("Ump_Reports/ump_report_test.Rmd")
source(here("Ump_Reports", "ump_report.R"))
source(here("Ump_Reports", "zone_analysis.R"))

```
\vspace*{-8em}
\begin{center}
\vspace*{-1em}
\LARGE \textbf{Corn Crib Umpire Report}
\vspace*{-1em}
\end{center}


\begin{center}
\begin{minipage}{0.28\textwidth}
\centering
\Large \textbf{`r params$away_team` vs `r params$home_team`}
\end{minipage}
\hfill
\begin{minipage}{0.28\textwidth}
\centering
\includegraphics[width=\textwidth]{ump-mask.png}
\end{minipage}
\hfill
\begin{minipage}{0.28\textwidth}
\centering
\Large `r params$game_date`
\end{minipage}
\vspace*{-1em}
\end{center}



```{r data import/cleaning, include=FALSE}

if (params$league == "KCL") {
  df <- read_csv(here("kclData", params$game_data))
} else {
  df <- read_csv(here("CornBeltersData", params$game_data))
}

# Setup function calls
calls <- classify(df)
split_calls <- splits(calls)
plots <- rings(calls)
incorrect_balls <- split_calls$iz %>%
   filter(PitchCall == 'BallCalled')
incorrect_strikes <- split_calls$oz %>%
  filter(PitchCall == "StrikeCalled")
misses <- missed_calls(incorrect_balls, incorrect_strikes)


ggsave("plots/overall_accuracy.png", create.dir = T,
       plots$overall, width = 3.5, height = 3.2, dpi = 300)
ggsave("plots/missed_calls.png", create.dir = T,
       misses, width = 3, height = 3, dpi = 300)
ggsave("plots/iz_accuracy.png", create.dir = T,
       plots$iz, width = 2, height = 2, dpi = 300)
ggsave("plots/oz_accuracy.png", create.dir = T,
       plots$oz, width = 2, height = 2, dpi = 300)
percentile <- round(ecdf(overall_acc)(plots$accuracy) * 100)


```

\begin{center}
\centering
\vspace{1em}
\Large \textbf{Overall Accuracy}
\end{center}

\begin{center}
\begin{minipage}[t]{\textwidth}
\begin{minipage}[t]{0.25\textwidth}
\centering
\vspace*{-5em}
\textbf{Called `r plots$correct` out of}
\textbf{`r plots$total` taken pitches correctly}
\end{minipage}
\hfill
\begin{minipage}[t]{0.28\textwidth}
\centering
\includegraphics[width=0.8\textwidth]{plots/overall_accuracy.png}
\end{minipage}
\hfill
\begin{minipage}[t]{0.25\textwidth}
\centering
\vspace*{-4em}
\textbf{KCL Accuracy Percentile: `r percentile`}
\end{minipage}
\end{minipage}
\end{center}
\begin{center}
\Large \textbf{All Missed Calls}
\end{center}

\vspace{1em}

\begin{center}
\begin{minipage}{0.3\textwidth}
\centering
\includegraphics[height=2.2in]{plots/missed_calls.png}
\end{minipage}
\hfill
\begin{minipage}{0.3\textwidth}
\centering
\includegraphics[height=1.6in]{plots/iz_accuracy.png}
\end{minipage}
\hfill
\begin{minipage}{0.3\textwidth}
\centering
\includegraphics[height=1.6in]{plots/oz_accuracy.png}
\end{minipage}
\end{center}
